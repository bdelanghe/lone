# shellcheck shell=bash

# https://github.com/steveyegge/beads/blob/main/docs/WORKTREES.md#fully-separate-beads-repository
export BEADS_DIR="${XDG_DATA_HOME:-$HOME/.local/share}/beads/io.github/bdelanghe/lone/.beads"

# Add scripts to PATH for agent-friendly wrapper commands
export PATH="$PWD/scripts:$PATH"

# Docker image configuration
IMAGE="semantic-test"
WORKDIR="/workspace"

# Wrapper functions for interactive shell use
dsh() {
  docker run --rm -it \
    -v "$(pwd):${WORKDIR}" \
    -w "${WORKDIR}" \
    "${IMAGE}" \
    bash -lc "${*:-bash}"
}

dtest() {
  # Run tests and show last 30 lines, preserving exit code
  docker run --rm \
    -v "$(pwd):${WORKDIR}" \
    -w "${WORKDIR}" \
    "${IMAGE}" \
    bash -lc 'deno test -A 2>&1 | tail -n 30; exit ${PIPESTATUS[0]}'
}

dci() {
  docker run --rm \
    -v "$(pwd):${WORKDIR}" \
    -w "${WORKDIR}" \
    "${IMAGE}" \
    deno task ci
}
