# shellcheck shell=bash

# Worktree-specific Beads setup:
# https://github.com/steveyegge/beads/blob/main/docs/ADVANCED.md#git-worktrees
_git_dir="$(git rev-parse --git-dir 2>/dev/null || true)"
_git_common_dir="$(git rev-parse --git-common-dir 2>/dev/null || true)"
if [ -n "$_git_dir" ] && [ -n "$_git_common_dir" ] && [ "$_git_dir" != "$_git_common_dir" ]; then
  # Linked worktree: force shared Beads store.
  export BEADS_DIR="${XDG_DATA_HOME:-$HOME/.local/share}/beads/io.github/bdelanghe/lone/.beads"

  # Always force direct mode in linked worktrees.
  # This avoids daemon/worktree branch confusion entirely.
  export BEADS_NO_DAEMON="${BEADS_NO_DAEMON:-1}"
fi
unset _git_dir _git_common_dir

# Add scripts to PATH for canonical test command
export PATH="$PWD/scripts:$HOME/.npm-global/bin:$PATH"
export BDUI_URL="http://127.0.0.1:3000"
